#!/usr/bin/env -S uv run --script
# /// script
# requires-python = ">=3.12"
# dependencies = [
# ]
# ///

"""
- As a user, I want to scan all `.md` files in `~/code/notes/df/`.
- As a user, I want to automatically delete any file that only contains a single `#` character and optional whitespace.
- As a user, I want to automatically delete any file that contains the string `#rm`.
- As a user, I want the script to run silently on success and only print messages for errors.
"""

import sys
from pathlib import Path

def main():
    try:
        target_dir = Path.home() / "code" / "notes" / "df"
        
        if not target_dir.is_dir():
            print(f"Error: Directory not found: {target_dir}", file=sys.stderr)
            sys.exit(1)

        for file_path in target_dir.glob("*.md"):
            try:
                content = file_path.read_text(encoding="utf-8")
                
                should_delete = False
                
                if content.strip() == "#":
                    should_delete = True
                elif "#rm" in content:
                    should_delete = True
                
                if should_delete:
                    try:
                        file_path.unlink()
                    except OSError as e:
                        print(f"Error: Could not remove file {file_path}: {e}", file=sys.stderr)
            
            except OSError as e:
                print(f"Error: Could not read file {file_path}: {e}", file=sys.stderr)
            except UnicodeDecodeError as e:
                print(f"Error: Could not decode file {file_path} as UTF-8: {e}", file=sys.stderr)

    except Exception as e:
        print(f"An unexpected error occurred: {e}", file=sys.stderr)
        sys.exit(1)

if __name__ == "__main__":
    main()
