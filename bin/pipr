#!/usr/bin/env bash

if [ $# -eq 0 ]; then
    echo "Usage: $0 <input_file>"
    exit 1
fi

input_file="$1"

if [ ! -f "$input_file" ]; then
    echo "Error: File '$input_file' not found"
    exit 1
fi

filename_without_ext="${input_file%.*}"
if [[ "$(uname)" == "Darwin" ]]; then
  caffeinate -d &
  open -a "Macs Fan Control"
fi

# COMMAND goes here
cat "$input_file" | piper --model ~/.local/share/piper-voices/en_US-lessac-high.onnx --output-file $filename_without_ext.wav

if [[ "$(uname)" == "Darwin" ]]; then
  osascript -e 'quit app "Macs Fan Control"'
fi
