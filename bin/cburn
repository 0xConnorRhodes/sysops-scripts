#!/usr/bin/env sh

# Wrapper script for caligula burn utility
# Usage: cburn <file>

if [ $# -eq 0 ]; then
    # Use fzf to select an ISO or ZST file from current directory
    file=$(find . -maxdepth 1 \( -name "*.iso" -o -name "*.zst" \) -type f | sed 's|^\./||' | fzf --prompt="Select Image File: ")

    # Check if user cancelled selection
    if [ -z "$file" ]; then
        echo "No file selected. Exiting."
        exit 1
    fi
else
    file="$1"
fi

# Check if file exists
if [ ! -f "$file" ]; then
    echo "Error: File '$file' not found"
    exit 1
fi

# Determine compression format based on file extension
if [[ "$file" == *.iso ]]; then
    compression="none"
elif [[ "$file" == *.gz ]]; then
    compression="gz"
elif [[ "$file" == *.bz2 ]]; then
    compression="bz2"
elif [[ "$file" == *.xz ]]; then
    compression="xz"
elif [[ "$file" == *.lz4 ]]; then
    compression="lz4"
elif [[ "$file" == *.zst ]]; then
    compression="zst"
else
    # For other files, use auto-detection
    compression="auto"
fi

caligula burn -z "$compression" -s skip --root always "$file"
